<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/quarto.js"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="README_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="metadata-schema-editor" class="level1">
<h1>Metadata schema editor</h1>
<p>This repository contains Javascript code and a CSS file to render a metadata schema editor. The editor was designed for the ManGO portal.</p>
<p>The goal of this editor is to be able to design forms for metadata schema implementation. If you want a web-interface that offers forms to assign metadata to data objects, you may want to organize the desired metadata based on pre-defined schemas, which contain desired fields, their possible formats and sometimes even their possible values. This can be implemented by designing a form with text/numeric input fields, radio buttons, checkboxes, dropdowns and even meaningful combinations of the above. The metadata schema editor allows to design the form, choosing the kinds of fields that suit your needs, assigning them IDs and labels and setting different properties, such as the kind of input for the text input fields (free text, e-mails, integers, floats…) and the selection of values for radios, checkboxes and dropdowns. Fields can be marked as required and both input fields and objects (i.e.&nbsp;combinations of fields) can be marked as repeatable. The output is then stored as a json file with the format of the “basic.json” example.</p>
<p>For information on the output format, check the documents in the “doc” folder of this repository.</p>
<section id="how-to-use" class="level2">
<h2 class="anchored" data-anchor-id="how-to-use">How to use</h2>
<p>The Javascript code in this repository needs to be hooked to a DOM element (typically a <code>&lt;div&gt;</code>) with the id “metadata_template_list_container”. This is defined in “src/init.js”. It also assumes that there is a custom tag “url-list” with a few custom fields that contain the urls to retrieve lists of existing metadata schemas and to save/update schemas.</p>
<p>The code in “src/init.js” reads the contents of this tag and stores the values of the urls in a <code>urls</code> object, which should have at least a <code>list</code> and a <code>new</code> item containing, respectively, the url to retrieve the list of existing metadata schema and the url to save new schemas or update existing ones. These urls are then used by the <code>Schema()</code> and <code>TemplatesRequest()</code> calls in the same file.</p>
<p>In other words, you could also provide the urls as an object by editing the code in “init.js” and providing your custom <code>urls</code> object to these calls.</p>
<p>All the Javascript files should be included in your HTML:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">"doms.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">"fields.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">"schema.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">"httprequests.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">"init.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or, for example, given a Jinja2 template:</p>
<pre class="jinja2"><code>{% for file in ['doms', 'fields', 'schema', 'httprequests', 'init'] %}
    &lt;script src="{{'dist/{}.js'.format(file)}}"&gt;&lt;/script&gt;
{% endfor %}</code></pre>
</section>
</section>
<section id="structure-of-the-javascript-files" class="level1">
<h1>Structure of the Javascript files</h1>
<p>The only file that actually runs code is “src/init.js”, which hooks to the DOM elements and creates everything you will see. It also creates a <code>Schema()</code> instance for the new schema you may want to design and a <code>TemplatesRequest()</code> class, which retrieves the list of existing schemas and then renders them.</p>
<p>The rest of the files define different classes then instantiated through the workflow.</p>
<section id="doms.js" class="level2">
<h2 class="anchored" data-anchor-id="doms.js">doms.js</h2>
<p>The DOMs file contains a number of classes that programmatically generate and manipulate DOM elements.</p>
<ul>
<li><p>The <code>Field</code> class only contains static elements that can be reused.</p></li>
<li><p>The <code>MovingField</code> class defines a box with an input field and buttons to move it up and down; it has the <code>MovingViewer</code> and <code>MovingChoice</code> subclasses which are used, respectively, for viewing created fields (and reordering them) and for defining the options in a multiple-choice field.</p></li>
<li><p>The <code>BasicForm</code> class sets up the common aspects to the forms that design the different fields, such as inputs and labels, switches and buttons.</p></li>
<li><p>The <code>Modal</code> and <code>AccordionItem</code> classes help create modals (to create forms) and accordion items (to create, view and edit schemas).</p></li>
</ul>
</section>
<section id="fields.js" class="level2">
<h2 class="anchored" data-anchor-id="fields.js">fields.js</h2>
<p>The Fields file contains a parent class called <code>InputField</code> that sets up the common ground for all kinds of fields that can be designed. It includes important attributes and methods to select them, design them, view them, edit them and retrieve information from their forms.</p>
<p>Its three main children are <code>TypedInput</code>, <code>MultipleInput</code> and <code>ObjectInput</code>, which are used to create scalar inputs (text, numbers…), multiple-choice inputs (radio and checkbox, dropdowns…) and objects (combinations of other kinds of inputs). The <code>MultipleInput</code> subclass has two further children: <code>SelectInput</code> for when only one of the possible answers can be selected, and <code>CheckboxInput</code> for when many of the possible answers can be selected. Both can be eventually rendered as dropdowns, but their alternative shapes are different: radio buttons for the former and checkbox for the latter.</p>
</section>
<section id="schema.js" class="level2">
<h2 class="anchored" data-anchor-id="schema.js">schema.js</h2>
<p>The Schema file contains a parent class <code>ComplexField</code> with two children: <code>ObjectEditor</code> and <code>Schema</code>. Since Object fields are basically mini schemas, their creation, edition and rendering should be very similar. <code>ComplexField</code> gathers their commonalities, whereas the subclasses specify what is particular for objects and schemas respectively.</p>
</section>
<section id="httprequests.js" class="level2">
<h2 class="anchored" data-anchor-id="httprequests.js">httprequests.js</h2>
<p>The HttpRequests file contains a class that extends <code>XMLHttpRequest</code>, <code>MangoRequest</code>, with two children: <code>TemplatesRequest</code> and <code>TemplateReader</code>. These classes are used to retrieve information from the server: the list of existing templates and individual templates, respectively.</p>
<p>For the moment, no such class is used for posting information to the server side.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>